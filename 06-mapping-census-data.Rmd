# Mapping Census data with R

Data from the United States Census Bureau are commonly visualized using maps, given that Census and ACS data are aggregated to enumeration units.  This chapter will cover the process of map-making using the tidycensus R package.  Notably, tidycensus enables R users to download _simple feature geometry_ for common geographies, linking demographic information with their geographic locations in a dataset.  In turn, this data model facilitates the creation of both static and interactive demographic maps. 

In this chapter, readers will learn how to use the `geometry` parameter in tidycensus functions to download geographic data along with demographic data from the US Census Bureau.  The chapter will then cover how to make static maps of Census demographic data using the popular ggplot2 and tmap visualization packages.  The closing parts of the chapter will then turn to interactive mapping, with a focus on the mapview and Leaflet R packages for interactive cartographic visualization.  

## Using geometry in tidycensus

As covered in the previous chapter, Census geographies are available from the tigris R package as simple features objects, using the data model from the sf R package.  tidycensus wraps several common geographic data functions in the tigris package to allow R users to return simple feature geometry pre-linked to downloaded demographic data with a single function call.  The key argument to accomplish this is `geometry = TRUE`, which is available in the core data download functions in tidycensus, `get_acs()`, `get_decennial()`, and `get_estimates()`.  

The following example illustrates the use of the `geometry = TRUE` argument, fetching information on median household income for Census tracts in the District of Columbia.  As discussed in the previous chapter, the option `tigris_use_cache = TRUE` is used to cache the downloaded geographic data on the user's computer.  

```{r}
library(tidycensus)
options(tigris_use_cache = TRUE)

dc_income <- get_acs(geography = "tract", 
                     variables = c(hhincome = "B19013_001"), 
                     state = "DC", 
                     geometry = TRUE)

dc_income

```

As shown in the example call, the structure of the object returned by tidycensus resembles the object we've become familiar with to this point in the book.  For example, median household income data are found in the `estimate` column with associated margins of error in the `moe` column, along with a variable ID, GEOID, and Census tract name.  However, there are some notable differences.  The `geometry` column contains polygon feature geometry for each Census tract, allowing for a linking of the estimates and margins of error with their corresponding locations in Washington, DC.  Beyond that, the object is associated with coordinate system information - using the NAD 1983 geographic coordinate system in which Census geographic datasets are stored by default.  

Such geographic information is very difficult to parse, however, without visualization. As the returned object is a simple features spatial object as represented by the __sf__ package, it can be plotted using sf's `plot()` function.  Key here is specifying the name of the column to be plotted - `"estimate"` in this case - inside of brackets.  

```{r}
plot(dc_income["estimate"])
```

The `plot()` function returns a simple map showing income variation in Washington, DC.  Wealthier areas, as represented with warmer colors, tend to be located in the northwestern part of the District.  `NA` values are represented on the map in white.  If desired, the map can be modified further with base plotting functions.  

The remainder of this chapter, however, will focus on map-making with additional data visualization packages in R.  This includes the popular __ggplot2__ package for visualization, which supports direct visualization of simple features objects; the __tmap__ package for thematic mapping, and the __leaflet__ package for interactive map-making which calls the Leaflet JavaScript framework directly from R.  

## Map-making with ggplot2 and geom_sf (July 13)

__ggplot2__ version 3.0 (released in 2018) included support for mapping simple features objects directly for the first time with the `geom_sf()` function.  `geom_sf()` reads in the simple feature geometry - whether point, line, or polygon - and interprets it accordingly to make a map.  As illustrated in Chapter 5, `geom_sf()` can be used for quick plotting of sf objects using familiar ggplot2 syntax.  Beyond this, ggplot2 users can supply an aesthetic mapping, as with other chart types, to generate maps.  

One of the most common ways to visualize statistical information on a map is with _choropleth mapping_.  Choropleth maps use shading to represent how underlying data values vary by feature in a spatial dataset.  The income plot of Washington, DC shown earlier in this chapter is an example of a choropleth map.  

In the example below, tidycensus is used to obtain linked ACS and spatial data on median age by state for the 50 US states plus the District of Columbia.  The additional argument used, `shift_geo = TRUE`, is available for states and counties when the 50 states + DC are requested.  This argument moves and re-scales Alaska and Hawaii to the south of Arizona and uses an Albers projection, courtesy of the [albersusa package](https://github.com/hrbrmstr/albersusa), to view US trends on the same graphic without setting up insets.  

```{r}
library(tidycensus)
library(ggplot2)

us_median_age <- get_acs(geography = "state",
                         variables = "B01002_001",
                         geometry = TRUE,
                         shift_geo = TRUE)

plot(us_median_age$geometry)

```
The state polygons can be styled using ggplot2 conventions and the `geom_sf()` function.  With two lines of ggplot2 code, a basic map of median age by state can be created with ggplot2 defaults.

```{r}
m1 <- ggplot(data = us_median_age, aes(fill = estimate)) + 
  geom_sf()

m1
```
The `geom_sf()` function in the above example interprets the geometry of the sf object (in this case, polygon) and visualizes the result as a filled _choropleth_ map.  A choropleth map is a type of map that displays statistical variation as color differences along a gradient.  In this case, using  

## Map-making with tmap (July 14)

## Merging tabular Census data to Census geographic data (July 14)

## Interactive mapping with leaflet (July 15)

## Web mapping applications with shiny (July 15)

## "Big Census Data" visualization with Mapbox (July 16-17)
